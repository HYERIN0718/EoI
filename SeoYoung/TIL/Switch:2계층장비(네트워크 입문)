MAC 주소를 기반으로 동작. LAN에서 동작.

01. MAC 주소를 인식하고 패킷 전달 (기본 동작)
02. VLAN
03. STP 
++ (보안,모니터링)

패킷 전송 시 경합으로 인한 성능 저하를 없애고 패킷을 동시에 여러 장비가 서로 간섭 없이 통신하도록 도와줌.

*** 첫 번째 기능(맥 주소 인식하고 패킷 전달)
: MAC 주소와 인터페이스 정보를 매핑한 MAC 주소 테이블
: 스위치는 전송하려는 패킷의 헤더 안에 있는 2계층 목적지 주소를 확인하고 테이블에서 해당 주소가 어느 포트에 있는지 확인해 해당 패킷을 그 포트로만 전송한다.
: " 테이블에 없는 도착지 주소를 가진 패킷은 전체 포트로 전송 "
- 플러딩 : 모든 포트로 패킷을 흘림
- 어드레스 러닝 : MAC 주소 테이블을 만들고 유지히는 과정 (브로드캐스트나 멀티캐스트에 대한 MAC 주소를 학습할 수는 없음)
- 포워딩/필터링 : 스위치에 패킷이 들어왔을 때, MAC 테이블과 비교해 맞는 정보가 있으면 해당 포트로 패킷을 포워딩, 다른 포트로는 패킷을 보내지 않으므로 필터링.
(( 포워딩과 필터링 작업이 여러 포트에서 동시에 수행될 수 있음 )) (( 일반적인 유니캐스트에 대해서만 ))
(( 브로드캐스트나 멀티캐스트는 모두 플러딩 ))

이더넷-TCP/IP 네트워크에서는 스위치가 유니캐스트를 플러딩하는 경우는 거의 없다. ARP 브로드캐스트가 먼저 수행됨.
ARP와 MAC 테이블은 에이징 타임동안 지워지지 않는다.'

*** VLAN
: 하나의 물리 스위치에서 여러 개의 네트워크를 나누어 사용 가능.
: 할당 방식에는 포트 기반과 MAC 주소 기반(=다이나믹 VLAN)으로 나뉜다. 

??? Dynamic VLAN 알아두면 좋지 않을까? ???

나누어진 VLAN 간에 통신할 때 일일이 포트로 연결하면 낭비가 심하므로 태그 기능이 생겼다.
태그 기능 : 하나의 포트에 여러 개의 VLAN을 함께 전송할 수 있게 해줌.
=> 태그 포트 = 트렁크 포트
(( 트렁크는 시스코에서 사용하는 단어 )
=> MAC 테이블에도 VLAN을 지정히는 필드가 추가됨.

*** STP
루프로 문제가 발생했다면 대부분의 원인은 브로드캐스트 스톰.

- 브로드캐스트 스톰 
: 루프 구조 상태에서 브로드캐스트를 발생시키면 스위치는 패킷이 유입된 포트를 제외하고 모든 포트로 패킷을 플러딩한다.
: 이 패킷을 받은 다른 스위치는 유입된 포트를 제외하고 나머지 포트로 또 플러딩.
: 루프 구조이기 때문에 이 패킷이 계속 돌아가고, 이를 브로드캐스트 스톰이라고 한다.
: 3계층과 달리 헤더에 TTL 이 없음

- 스위치 MAC러닝 중복 문제 (MAC address Flapping)
: 유니캐스트도 루프 구조에선 문제.
: 스위치는 MAC 주소를 학습하는 데 직접 전달되는 패킷과 스위치를 돌고 돌아 들어간 패킷 간의 포트가 달라 MAC 주소를 정상적으로 학습할 수 없음.


STP : 루프를 자동 감지해 포트를 차단하고 장애 때문에 우회로가 없을 때 차단된 포트를 스위치 스스로 다시 풀어줌 // 뿌리부터 가지까지 루프가 생기지 않도록.
STP를 통해 루프를 예방하려면 스위치의 전체적인 연결 상황을 알아야 함.
BPDU(Bridge Protocol Data Unit)라는 프로토콜을 이용해 스위치 간에 정보를 전달하고 수집된 정보를 이용해 전체 네트워크 트리를 만들어 루프 구간 확인 가능.
BPDU에 스위치가 갖고 있는 ID와 같은 고유값.

Disabled - Blocking(20초) - Listening(15초) - Learning(15초) - Forwarding
STP는 뿌리가 되는 가장 높은 스위치를 선출한다. ROOT SWITCH
-> BPDU를 통해 2초마다 자신이 루트 스위치임을 광고.

일반 PC나 서버는 스위치인지 판단하는 과정을 굳이 거칠 필요가 없음. 시간이 지연되기 때문에.
-> PortFast 이용하면 BPDU 대기, 습득 과정 없이 바로 포워딩
-> PortFast를 설정한 포트에 스위치가 들어올지 모르는 상황에 대비해 BPDU Guard.


*** RSTP (Rapid)
: 2~3초로 절체 시간이 짧음
: BPDU 메시지 형식이 다양해짐
: 토폴로지 변경이 일어난 스위치 자신이 모든 네트워크에 토볼로지 변경을 직접 전파. +++++여기.

*** MST
(일반 스패닝 트리 프로토콜을 CST라고 한다)
PVST (Per VLAN) : VLAN 마다 다른 스패닝 트리 프로토콜. -> VLAN 마다 별도의 블록 포트를 지정해 네트워크 로드를 셰어링 가능. 그러나 기능만큼 부담이 있음
: MST는 CST , PVST의 단점 보완.
: 여러 개의 VLAN을 그룹으로 묶고 그 그룹마다 별도의 STP.
: PVST 보다 훨씬 적은 STP 프로세스가 돌게 되고, PVST의 장점인 로드 셰어링도 가능.
리전!! 개념!!!







